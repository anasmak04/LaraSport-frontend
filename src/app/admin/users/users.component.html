<div>
  <app-header></app-header>
  <div class="flex overflow-hidden bg-white pt-16 h-screen">
    <app-sidebar></app-sidebar>
    <div
      class="bg-gray-900 opacity-50 hidden fixed inset-0 z-10"
      id="sidebarBackdrop"
    ></div>
    <div
      id="main-content"
      class="w-full bg-gray-50 relative overflow-y-auto lg:ml-64"
    >
      <div
        *ngIf="loader.isLoading | async"
        class="relative z-0 overflow-x-auto shadow-md sm:rounded-lg"
      >
      </div>

      <div class="flex justify-center pt-8 mb-4">
        <div class="relative w-full max-w-lg">
          <input
            type="text"
            [(ngModel)]="searchTerm"
            (keyup)="search(searchTerm)"
            placeholder="Search cities..."
            class="w-full bg-white text-gray-700 border border-gray-300 rounded-lg py-3 pl-12 pr-4 transition duration-200 ease-in-out transform focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-500 shadow-md"
          />
     
        </div>
      </div>

      @if (searchTerm == "") {
        <div
        *ngIf="!(loader.isLoading | async)"
        class="relative z-0 m-4 overflow-x-auto shadow-md sm:rounded-lg"
      >
        <table
          class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400"
        >
          <caption
            class="p-5 text-lg font-semibold text-left rtl:text-right text-gray-900 bg-white"
          >
            Users Management
            <p
              class="mt-1 text-sm font-normal text-gray-500 dark:text-gray-400"
            >
              Browse, add, or modify users within the system. This table
              provides an overview of all users currently managed, including
              options to edit or delete each entry as needed.
            </p>
          </caption>

          <thead
            class="text-xs text-gray-700 uppercase bg-gray-50 dark:text-gray-400"
          >
            <tr>
              <th scope="col" class="px-6 py-3">Id</th>
              <th scope="col" class="px-6 py-3">First Name</th>
              <th scope="col" class="px-6 py-3">Last Name</th>
              <th scope="col" class="px-6 py-3">City</th>
              <th scope="col" class="px-6 py-3">Status</th>
              <th scope="col" class="px-6 py-3">Email</th>
              <th scope="col" class="px-6 py-3 text-center">Actions</th>
            </tr>
          </thead>

          <tbody *ngFor="let user of users">
            <tr class="bg-white border-b">
              <th
                scope="row"
                class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white"
              >
                {{ user.id }}
              </th>
              <td class="px-6 py-4">{{ user.firstname }}</td>
              <td class="px-6 py-4">{{ user.lastname }}</td>
              <td class="px-6 py-4">{{ user.city }}</td>
              <td class="px-6 py-4">
                <span
                  class="bg-green-100 text-green-800 text-xs font-medium me-2 px-2.5 py-0.5 rounded dark:bg-green-900 dark:text-green-300"
                  >{{ user.roles }}</span
                >
              </td>
              <td class="px-6 py-4">{{ user.email }}</td>
              <td class="px-6 py-4 text-center">
                <button
                  type="button"
                  class="focus:outline-none text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2"
                >
                  Delete
                </button>
                <button
                  type="button"
                  class="focus:outline-none text-white bg-yellow-400 hover:bg-yellow-500 focus:ring-4 focus:ring-yellow-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2"
                  (click)="toggleModal(user.id)"
                >
                  Edit
                </button>

                <div
                  *ngIf="selectedItemId === user.id"
                  class="fixed inset-0 bg-black bg-opacity-50 z-40 flex justify-center items-center"
                >
                  <div class="bg-white p-6 rounded-lg max-w-sm w-full mx-4">
                    <form
                      (ngSubmit)="
                        selectedRoleId !== null &&
                          attachRole(user.id, selectedRoleId)
                      "
                    >
                    <select [(ngModel)]="selectedRoleId" name="role" id="role" class="mb-4">
                      <option value="1">Admin</option>
                      <option value="2">User</option>
                      <option value="3">Manager</option>
                    </select>
                    
                      <button
                        type="submit"
                        class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-700"
                      >
                        Submit
                      </button>
                    </form>
                    <button
                      (click)="toggleModal(null)"
                      class="mt-4 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-700"
                    >
                      Close
                    </button>
                  </div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      }

      @else {
        <div
        *ngIf="!(loader.isLoading | async)"
        class="relative z-0 m-4 overflow-x-auto shadow-md sm:rounded-lg"
      >
        <table
          class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400"
        >
          <caption
            class="p-5 text-lg font-semibold text-left rtl:text-right text-gray-900 bg-white"
          >
            Users Management
            <p
              class="mt-1 text-sm font-normal text-gray-500 dark:text-gray-400"
            >
              Browse, add, or modify users within the system. This table
              provides an overview of all users currently managed, including
              options to edit or delete each entry as needed.
            </p>
          </caption>

          <thead
            class="text-xs text-gray-700 uppercase bg-gray-50 dark:text-gray-400"
          >
            <tr>
              <th scope="col" class="px-6 py-3">Id</th>
              <th scope="col" class="px-6 py-3">First Name</th>
              <th scope="col" class="px-6 py-3">Last Name</th>
              <th scope="col" class="px-6 py-3">City</th>
              <th scope="col" class="px-6 py-3">Status</th>
              <th scope="col" class="px-6 py-3">Email</th>
              <th scope="col" class="px-6 py-3 text-center">Actions</th>
            </tr>
          </thead>

          <tbody *ngFor="let user of Search">
            <tr class="bg-white border-b">
              <th
                scope="row"
                class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white"
              >
                {{ user.id }}
              </th>
              <td class="px-6 py-4">{{ user.firstname }}</td>
              <td class="px-6 py-4">{{ user.lastname }}</td>
              <td class="px-6 py-4">{{ user.city }}</td>
              <td class="px-6 py-4">
                <span
                  class="bg-green-100 text-green-800 text-xs font-medium me-2 px-2.5 py-0.5 rounded dark:bg-green-900 dark:text-green-300"
                  >{{ user.roles }}</span
                >
              </td>
              <td class="px-6 py-4">{{ user.email }}</td>
              <td class="px-6 py-4 text-center">
                <button
                  type="button"
                  class="focus:outline-none text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2"
                >
                  Delete
                </button>
                <button
                  type="button"
                  class="focus:outline-none text-white bg-yellow-400 hover:bg-yellow-500 focus:ring-4 focus:ring-yellow-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2"
                  (click)="toggleModal(user.id)"
                >
                  Edit
                </button>

                <div
                  *ngIf="selectedItemId === user.id"
                  class="fixed inset-0 bg-black bg-opacity-50 z-40 flex justify-center items-center"
                >
                  <div class="bg-white p-6 rounded-lg max-w-sm w-full mx-4">
                    <form
                      (ngSubmit)="
                        selectedRoleId !== null &&
                          attachRole(user.id, selectedRoleId)
                      "
                    >
                    <select [(ngModel)]="selectedRoleId" name="role" id="role" class="mb-4">
                      <option value="1">Admin</option>
                      <option value="2">User</option>
                      <option value="3">Manager</option>
                    </select>
                    
                      <button
                        type="submit"
                        class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-700"
                      >
                        Submit
                      </button>
                    </form>
                    <button
                      (click)="toggleModal(null)"
                      class="mt-4 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-700"
                    >
                      Close
                    </button>
                  </div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      }
    
    </div>
  </div>
</div>
